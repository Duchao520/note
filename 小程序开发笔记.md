## 小程序开发日志

#### 2019/12/09

问题：小程序安卓机支付完成进入微信后台页面时，调用**wx.reLauch**失败报错

系统：安卓

原因：小程序在进入后台不能调用小程序方法,在安卓内

兼容:  setTimeout进行延迟；

```js
wx.requestPayment({
    nonceStr,
    package: _package,
    paySign,
    signType,
    timeStamp,
    success: res => {
      setTimeout(() => {
        wx.reLaunch({
          url: '/pages/TC/pages/paySuccess/paySuccess'
        })
      })
    },
    fail: res => {
      wx.$showLoading()
      const url = 'billingCancel'
      request.post(url, cancelParams).then(res => {
        wx.$hideLoading()
        if (res.data.success) {
          wx.showToast({
            title: '支付取消',
          })
        }
      })
    }
  })
```



#### 2019/12/16

问题：小程序IOS swiper-item设置style宽高，分享小程序卡片再打开时，swiper-item内为空白，安卓下正常,IOS9.3正常，IOS其它版本未知；

系统：IOS13；

兼容：swiper-item不设置宽高样式，通过block占位元素修改；

```html
<swiper class="image-swiper" indicator-dots autoplay interval='3000' duration='1000' circular>
	<block wx:for="{{productInfo.productImage}}" wx:key="index">
		<swiper-item>
			<image src="{{format.getImageUrl(item)}}" class="slide-image" width="750rpx" height="750rpx" mode='aspectFill' bindtap='$previewImage' data-current="{{format.getImageUrl(item)}}" data-urls="{{format.getImageArr(productInfo.productImage)}}" lazy-load/>
		</swiper-item>
	</block>
</swiper>
```





#### 2019/12/23

问题： 小程序部分手机http请求返回responseHeaders中key值变为小写，因为鉴权Authorization被转为小写导致程序bug；

型号：vivo-V1809A

系统：Android 9;

原因：**HTTP/2** 和 **HTTP/1.x** 同样使用 **ASCII** 字符集，但 **HTTP/2** 的头必须使用小写，而不是 **HTTP/1.x** 大小写均可;

兼容：把所有HTTP的Header键字符串转换为小写，业务匹配时也用小写键名称(即toLowerCase)同时适配 **HTTP/2** 和 **HTTP/1.x** 。注意，如果转小写后出现多个相同Header，必须要求服务端修正，同时前端调整代码;





#### 2019/12/24~

> ##### 小程序优化

问题：小程序在性能稍低的安卓上出现闪屏

型号：LND-AL30(honor7C)

系统：Android 8.0.0

原因：小程序占用内存，内存不足

优化方向：

- 图片太大
- 存在图片尺寸太大而有效显示区域较小
- 存在短时间内发起太多的请求，按照业务对可合并的接口进行合并
- 存在 setData 的调用过于频繁，在所有请求结束后再进行页面数据刷新
- 存在可能没有对请求进行缓存的情况

解决：

##### 	图片加载

- 上传图片应对图片进行预处理（压缩，裁剪，缩放）
- 服务端对图片进行预处理（阿里云OSS图片处理功能，对大图进行按需裁剪缩放压缩）



##### 